{"version":3,"sources":["Damage.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/Script/AutoBattle/SkillEffect","sourcesContent":["import { BaseSkillEffect } from \"./BaseSkillEffect\";\nimport { SkillEffectEnum, DamageType } from \"./SkillEffectEnum\";\nimport { EffData } from \"../Model/EffectInfo\";\nimport { damageK } from \"../Config/AutoBattleConfig\";\nimport { printDefault, printBattleMsg, pTag, pBattleAction } from \"../OutPut/Printer\";\nimport { g_AutoBattleManager } from \"../AutoBattleManager\";\n\n/**\n * 对目标造成[0]点[1{1：普通，2：魔法，3：纯粹}]类型伤害\n */\nexport class Damage extends BaseSkillEffect {\n    constructor() {\n        super();\n    }\n\n    public get effectId(): number {\n        return SkillEffectEnum.damage;\n    }\n\n    public get effName(): string {\n        return \"point damage\";\n    }\n\n    /**\n     * play\n     */\n    public play(data: EffData): number {\n        let attacker = data.attacker;\n        let defender = data.defender;\n        if (!attacker || !defender || defender.isDead) {\n            return;\n        }\n        let rDamage = 0;\n        let skillEff = data.skillEff;\n        let damage = skillEff.effArr[0];\n        let damageType = skillEff.effArr[1];\n        switch (damageType) {\n            case DamageType.normal:\n                let flag = 1;\n                if (defender.defence < 0) {\n                    flag = -1;\n                }\n                let defence = Math.abs(defender.defence);\n                let per = 1 - flag * damageK.k1 * defence / (damageK.k2 + damageK.k3 * defence)\n                rDamage = damage * per;\n                break;\n            case DamageType.magic:\n                rDamage = damage * (100 - defender.mDefence) / 100.0;\n                break;\n            case DamageType.real:\n                rDamage = damage;\n            default:\n                break;\n        }\n        //判定战吼减伤\n        let warCryInfo = defender.getAttrChange(\"warCry\");\n        if (warCryInfo && warCryInfo.length > 0) {\n            let rp = 1;\n            for (let i = 0; i < warCryInfo.length; i++) {\n                const per = warCryInfo[i].info;\n                rp = rp * (100 - per) / 100;\n            }\n            printBattleMsg(pTag.battle, pBattleAction.warCry, { npc: defender, per: rp });\n            rDamage = rDamage * rp;\n        }\n        rDamage = Math.floor(rDamage);\n        //被放逐的目标不受物理伤害但是受到额外的魔法伤害\n        let banishInfo = defender.getAttrChange(\"banish\");\n        if (banishInfo && banishInfo.length > 0) {\n            if (damageType == DamageType.normal) {\n                rDamage = 0;\n            } else if (damageType == DamageType.magic) {\n                let per = banishInfo[0].info\n                rDamage = rDamage * per / 100;\n            }\n        }\n        //护盾减伤\n        if (rDamage > 0) {\n            let missDamageInfo = defender.getShieldState(\"MissDamageShield\");\n            if (missDamageInfo && missDamageInfo.length > 0) {\n                let arg = { damage: rDamage };\n                missDamageInfo[0].doShieldEffect(arg);\n                rDamage = arg.damage;\n            }\n        }\n\n        //伤害回蓝\n        defender.mp = defender.mp + Math.floor(rDamage / 10);\n        if (attacker && !attacker.isDead) {\n            attacker.mp = attacker.mp + Math.floor(rDamage / 10);\n        }\n        //dps统计\n        g_AutoBattleManager.addDpsInfo(attacker.thisId, attacker.baseId, attacker.isTeamA, rDamage);\n        //造成伤害\n        printBattleMsg(pTag.battle, pBattleAction.damage, { attacker: attacker, defender: defender, damage: rDamage });\n        defender.reduceHp(rDamage);\n        // defender.hp = defender.hp - rDamage;\n        if (defender.hp <= 0) {\n            defender.die();\n        }\n\n        return rDamage;\n    }\n}\n"]}